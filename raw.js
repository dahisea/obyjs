!function(){let t="";const e={NODE_A:"https://api-edge-sakiko-dispatch-network-aws-nf-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",NODE_B:"https://tencent.api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",NODE_C:"https://api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",NODE_D:"https://dev-volcengine-auth.netlify.app/318895e9-64a7-4441-9ee4-625cae200f9b"},n=Object.values({NODE_M:"https://web-static-origin.dahi.edu.cn.dahi.e.yu.ac.cn/img/banner/pc.jpg"})[0],s=Object.values(e);async function a(){const t=Math.floor(Date.now()/1e3).toString().substring(0,8);return{ss:(await async function(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("")}(t)).substring(0,9)}}function o(){const e=window.location.hash;return"#google_vignette"===e?(console.log("Detected google_vignette, using last valid hash:",t),i(t)):e&&"#"!==e&&"#?"!==e||!t||"#"===t||"#?"===t?(e&&"#google_vignette"!==e&&"#"!==e&&"#?"!==e&&(t=e),i(e)):(console.log("Empty hash detected, restoring:",t),window.location.hash=t,i(t))}function i(t){const e=t.startsWith("#?")?t.substring(2):"",n=new URLSearchParams(e),s={};for(const[t,e]of n.entries())s[t]=e;return s}async function r(t){const e=o();delete e.locale;const n=await a();e.ss=n.ss;const s=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&");return s?`${t}?${s}`:t}function l(t){const e=document.getElementById(`skeleton-${t}`);if(!e)return;const n=JSON.parse(e.dataset.itemData||"{}"),s=e.querySelector("article");if(!s||!n.id)return;const a=n.users?.[0]?.id||"",o=a?`https://gfork.zh-tw.eu.org/zh-hans/users/${a}`:"#",i=n.users?.[0]?.name||"未知作者",r=`https://gfork.zh-tw.eu.org/zh-hans/scripts/${n.id}`;let l=n.code_url||"#";l.includes("update.greasyfork.org/scripts/")&&(l=l.replace("https://update.greasyfork.org/scripts/","/d#/"));const c=s.querySelector(".script-link-placeholder");if(c){const t=document.createElement("a");t.className="script-link",t.href=r,t.target="_blank",t.textContent=c.textContent,c.replaceWith(t)}const d=s.querySelector(".script-list-author dd span");d&&a&&(d.innerHTML=`<a href="${o}">${i}</a>`);const p=s.querySelector(".inline-script-stats");if(p&&!p.querySelector('a[href*="立即安装"]')){const t=document.createElement("a");t.href=l,t.target="_blank",t.textContent="立即安装此脚本",p.appendChild(t)}e.style.opacity="1",e.style.pointerEvents="auto"}function c(t,e=!1){const n=document.querySelector("footer");if(!n)return;let s=document.getElementById("api-status");if(!e)return void(s&&s.remove());s||(s=document.createElement("div"),s.id="api-status",s.className="api-status",n.appendChild(s));const a=t.map((t=>{const e=t.status||"pending";return`\n<div class="api-item ${e}">\n<span class="material-icons">${{success:"check_circle",pending:"autorenew",error:"error"}[e]||"autorenew"}</span>\n<span>${t.name}</span>\n</div>\n`})).join("");s.innerHTML=`\n<div>备用节点状态：</div>\n<div class="api-list">${a}</div>\n`}async function d(){if("#google_vignette"===window.location.hash)return void console.log("Skipping reload for google_vignette");!function(){const t=o(),e=t.q||"",n=t.site||"",s="GFork 檢索";document.title=e?n?`${e} - ${s}（${n}）`:`${e} - ${s}`:s}();const t=document.getElementById("script-results");if(!t)return void console.error("Results container not found");t.innerHTML=function(t){let e="<ul>";for(let n=0;n<t;n++)e+=`\n<li class="skeleton-item" id="skeleton-${n}">\n<article>\n<h2>\n<span class="skeleton-title"></span>\n<span class="skeleton-badge"></span>\n<span class="skeleton-separator"></span>\n<span class="skeleton-description"></span>\n</h2>\n<div class="script-meta-block">\n<dl class="inline-script-stats">\n<dt><span>作者</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>日安装量</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>总安装量</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>评分</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>创建于</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>更新于</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n</dl>\n</div>\n</article>\n<div class="loading-overlay">\n<div class="loading-spinner">\n<span class="material-icons">autorenew</span>\n<div class="loading-tip">少女祈祷中…正等待加载脚本。注意：所有结果均来源于网络搜索，可靠性未知，请注意甄别代码以及相关内容，谨防欺诈。</div>\n</div>\n</div>\n</li>`;return e+="</ul>",e}(10);let a=document.getElementById("local-overlay");a||(a=document.createElement("div"),a.id="local-overlay",a.style.cssText="\nposition: absolute;\ntop: 0;\nleft: 0;\nwidth: 100%;\nheight: 100%;\nbackground: rgba(255, 255, 255, 0.3);\nz-index: 100;\npointer-events: none;\n",t.style.position="relative",t.appendChild(a));let i=!1;try{const t=await r(n),e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},mode:"cors"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const s=e.headers.get("content-type");if(!s||!s.includes("application/json"))throw new Error("Response is not JSON format");const a=await e.json();i=!0,p(a)}catch(n){console.log("主节点失败，切换到备用节点:",n);const o=Object.keys(e).map((t=>({name:t,status:"pending"})));c(o,!0);const l=s.map((async(t,e)=>{try{const n=await r(t),s=await fetch(n,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},mode:"cors"});if(!s.ok)throw new Error(`HTTP ${s.status}`);const a=s.headers.get("content-type");if(!a||!a.includes("application/json"))throw new Error("Response is not JSON format");const l=await s.json();return i||(i=!0,o[e].status="success",c(o,!0),p(l)),{success:!0,index:e}}catch(t){return o[e].status="error",c(o,!0),{success:!1,index:e,error:t}}}));Promise.all(l).then((e=>{0!==e.filter((t=>t.success)).length||i||(t.innerHTML='<div class="error">所有API请求失败，请稍后重试</div>',a&&a.remove())}))}}function p(t){if(!0===t.redirect&&t.target_url)return alert(t.message||"检测到非中文区域，将跳转到 Greasyfork 官方站点"),void(window.location.href=t.target_url);const e=document.getElementById("script-results");if(!e)return;if(!t||0===t.length){e.innerHTML='<div class="loading">未找到匹配內容</div>';const t=document.getElementById("local-overlay");return t&&t.remove(),void h(!0)}const n=t.length,s=e.querySelectorAll(".skeleton-item").length;if(n>s){const t=e.querySelector("ul");if(t)for(let e=s;e<n;e++){const n=document.createElement("li");n.className="skeleton-item",n.id=`skeleton-${e}`,n.innerHTML='\n<article>\n<h2>\n<span class="skeleton-title"></span>\n<span class="skeleton-badge"></span>\n<span class="skeleton-separator"></span>\n<span class="skeleton-description"></span>\n</h2>\n<div class="script-meta-block">\n<dl class="inline-script-stats">\n<dt><span>作者</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>日安装量</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>总安装量</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>评分</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>创建于</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>更新于</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n</dl>\n</div>\n</article>\n<div class="loading-overlay">\n<div class="loading-spinner">\n<span class="material-icons">autorenew</span>\n<div class="loading-tip">少女祈祷中…正等待加载脚本。注意：所有结果均来源于网络搜索，可靠性未知，请注意甄别代码以及相关内容，谨防欺诈。</div>\n</div>\n</div>\n',t.appendChild(n)}}t.forEach(((t,e)=>{!function(t,e){const n=document.getElementById(`skeleton-${t}`);if(!n)return;const s=n.querySelector("article");if(!s)return;const a=e.users?.[0]?.name||"未知作者",o=e.created_at?new Date(e.created_at):null,i=e.code_updated_at?new Date(e.code_updated_at):null,r=t=>t?`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`:"未知";s.innerHTML=`\n<h2>\n<span class="script-link-placeholder">${e.name||"未命名"}</span>\n<span class="badge badge-js" title="用户脚本">JS</span>\n<span class="name-description-separator">-</span>\n<span class="script-description description">${e.description||"暂无描述"}</span>\n</h2>\n<div class="script-meta-block">\n<dl class="inline-script-stats">\n<dt class="script-list-author"><span>作者</span></dt>\n<dd class="script-list-author"><span>${a}</span></dd>\n<dt class="script-list-daily-installs"><span>日安装量</span></dt>\n<dd class="script-list-daily-installs"><span>${e.daily_installs||0}</span></dd>\n<dt class="script-list-total-installs"><span>总安装量</span></dt>\n<dd class="script-list-total-installs"><span>${e.total_installs||0}</span></dd>\n<dt class="script-list-ratings"><span>评分</span></dt>\n<dd class="script-list-ratings" data-rating-score="${e.fan_score||0}">\n<span>\n<span class="good-rating-count" title="评级为好评或已加入到收藏的人数">${e.good_ratings||0}</span>\n<span class="ok-rating-count" title="评级为一般的人数">${e.ok_ratings||0}</span>\n<span class="bad-rating-count" title="评级为差评的人数">${e.bad_ratings||0}</span>\n</span>\n</dd>\n<dt class="script-list-created-date"><span>创建于</span></dt>\n<dd class="script-list-created-date"><span>${r(o)}</span></dd>\n<dt class="script-list-updated-date"><span>更新于</span></dt>\n<dd class="script-list-updated-date"><span>${r(i)}</span></dd>\n</dl>\n</div>\n`;const l=n.querySelector(".loading-overlay");l&&l.remove(),n.classList.remove("skeleton-item"),n.classList.add("fade-in"),n.dataset.itemData=JSON.stringify(e)}(e,t)}));for(let t=n;t<100;t++){const e=document.getElementById(`skeleton-${t}`);if(!e)break;e.remove()}setTimeout((()=>{const t=e.querySelector("ul");if(t&&t.firstChild){const e=document.createElement("div");e.className="ad-container",e.innerHTML='\n<ins class="adsbygoogle" \n style="display:block" \n data-ad-client="ca-pub-3758644447684310" \n data-ad-slot="4095096984" \n data-ad-format="auto" \n data-full-width-responsive="true"></ins>\n<script>(adsbygoogle=window.adsbygoogle||[]).push({});<\/script>\n',t.insertBefore(e,t.firstChild)}setTimeout((()=>{for(let t=0;t<n;t++)l(t);const t=document.getElementById("local-overlay");t&&(t.style.opacity="0",setTimeout((()=>t.remove()),300))}),300)}),200),h(!1)}function u(t){t.preventDefault();const e=document.getElementById("search-submit");if(!e)return void console.error("Search input not found");const n=e.value.trim(),s=new URL(window.location);s.hash=n?`#?q=${encodeURIComponent(n)}`:"#",window.history.pushState({},"",s),d()}function h(t=!1){const e=window.location.hash.substring(2);if(!e)return;const n=new URLSearchParams(e),s=parseInt(n.get("page")||"1"),a=document.getElementById("pagination");if(a){const e=new URLSearchParams(n),o=new URLSearchParams(n),i=new URLSearchParams(n);e.set("page","1");const r=Math.max(s-1,1);o.set("page",r.toString()),i.set("page",(s+1).toString());let l="";l+=`<a href="#?${e.toString()}" ${1===s?'style="visibility:hidden"':""}>回到第一页</a>`,l+=`<a href="#?${o.toString()}" ${1===s?'style="visibility:hidden"':""}>上一页</a>`,l+=`<span class="current">${s}</span>`,l+=t&&s>1?`<a href="#?${i.toString()}" style="visibility:hidden">下一页</a>`:`<a href="#?${i.toString()}">下一页</a>`,a.innerHTML=l}}function g(){const t=o().filter_locale||"0",e=document.getElementById("language-filter");e&&(e.innerHTML=`\n语言筛选：\n<ul>\n<li class="list-option ${"0"===t?"list-current":""}">\n<a href="#" data-filter="0">展示所有语言内容</a>\n</li>\n<li class="list-option ${"1"===t?"list-current":""}">\n<a href="#" data-filter="1">仅展示中文内容</a>\n</li>\n</ul>\n`,e.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault();const n=this.getAttribute("data-filter"),s=o();s.filter_locale=n,Object.keys(s).forEach((t=>{s[t]||delete s[t]}));const a=new URL(window.location.href);a.hash=`#?${new URLSearchParams(s).toString()}`,window.history.pushState({},"",a),e.querySelectorAll(".list-option").forEach((t=>{t.classList.remove("list-current")})),this.parentElement.classList.add("list-current"),d()}))})))}function f(){const t=document.getElementById("search-form");t&&t.addEventListener("submit",u);const e=document.querySelector(".sidebar-search");e&&e.addEventListener("submit",(function(t){t.preventDefault();const n=e.querySelector('input[name="q"]');if(!n)return;const s=o(),a={q:n.value.trim(),sort:s.sort||"",filter_locale:s.filter_locale||"0"};s.site&&(a.site=s.site),Object.keys(a).forEach((t=>{a[t]||delete a[t]}));const i=new URL(window.location.href);i.hash=`#?${new URLSearchParams(a).toString()}`,window.history.pushState({},"",i),m(a.sort||""),d()}))}function m(t){const e=document.getElementById("sort-options-list");if(!e)return;const n=e.querySelectorAll(".list-option");n.forEach((t=>{t.classList.remove("list-current")})),n.forEach((e=>{const n=e.querySelector("a");if(n){const s=new URL(n.href,window.location.origin);(new URLSearchParams(s.hash.substring(2)).get("sort")||"")===t&&e.classList.add("list-current")}}))}function v(){const t=o(),e=t.q||"",n=t.sort||"",s=t.filter_locale||"0",a=t.site||"",i=document.querySelector('.sidebar-search input[name="q"]');i&&(i.value=e);const r=[{value:"",text:"相关程度"},{value:"daily_installs",text:"日安装量"},{value:"total_installs",text:"总安装量"},{value:"ratings",text:"得分"},{value:"created",text:"创建日期"},{value:"updated",text:"更新日期"},{value:"name",text:"名称"}],l=document.getElementById("sort-options-list");l&&(l.innerHTML="",r.forEach((t=>{const o=document.createElement("li");o.className="list-option",t.value===n&&o.classList.add("list-current");const i=document.createElement("a"),r={q:e,sort:t.value,filter_locale:s};a&&(r.site=a),Object.keys(r).forEach((t=>{r[t]||delete r[t]})),i.href=`#?${new URLSearchParams(r).toString()}`,i.textContent=t.text,i.addEventListener("click",(function(e){e.preventDefault(),m(t.value),window.history.pushState({},"",this.href),d()})),o.appendChild(i),l.appendChild(o)})),setTimeout((()=>m(n)),0)),g()}window.addEventListener("popstate",(function(){if("#google_vignette"===window.location.hash)return;m(o().sort||""),g(),d()})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){f(),v(),d()})):(f(),v(),d())}();