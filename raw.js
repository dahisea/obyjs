!function(){let t="",e=null,n=!1;const s={NODE_A:"https://api-edge-sakiko-dispatch-network-aws-nf-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",NODE_B:"https://tencent.api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",NODE_C:"https://api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",NODE_D:"https://dev-volcengine-auth.netlify.app/318895e9-64a7-4441-9ee4-625cae200f9b"},a=Object.values({NODE_M:"https://web-static-origin.dahi.edu.cn.dahi.e.yu.ac.cn/img/banner/info.xml"})[0],o=Object.values(s);async function i(){const t=Math.floor(Date.now()/1e3).toString().substring(0,8);return{ss:(await async function(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("")}(t)).substring(0,9)}}function r(t){return!(!t||"#"===t||"#?"===t)&&"#google_vignette"!==t}function l(){const n=window.location.hash;if("#google_vignette"===n)return c(t);if(!r(n))return t&&r(t)?c(t):{};t=n;const s=c(n);return s.q&&(e=s),s}function c(t){const e=t.startsWith("#?")?t.substring(2):"",n=new URLSearchParams(e),s={};for(const[t,e]of n.entries())s[t]=e;return s}async function d(t){const e=l();delete e.locale;const n=await i();e.ss=n.ss;const s=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&");return s?`${t}?${s}`:t}async function p(t){return new Promise((e=>{requestAnimationFrame((()=>{const n=document.getElementById(`skeleton-${t}`);if(!n)return void e();const s=JSON.parse(n.dataset.itemData||"{}"),a=n.querySelector("article");if(!a||!s.id)return void e();const o=s.users?.[0]?.id||"",i=o?`https://gfork.zh-tw.eu.org/zh-hans/users/${o}`:"#",r=`https://gfork.zh-tw.eu.org/zh-hans/scripts/${s.id}`;let l=s.code_url||"#";l.includes("update.greasyfork.org/scripts/")&&(l=l.replace("https://update.greasyfork.org/scripts/","/d#/")),a.querySelectorAll('a[data-placeholder="true"]').forEach((t=>{t.classList.contains("script-link")?(t.href=r,t.target="_blank"):t.parentElement.classList.contains("script-list-author")?t.href=i:t.textContent.includes("立即安装")&&(t.href=l,t.target="_blank"),t.removeAttribute("data-placeholder")})),e()}))}))}function u(t,e=!1){const n=document.querySelector("footer");if(!n)return;let s=document.getElementById("api-status");if(!e)return void(s&&s.remove());s||(s=document.createElement("div"),s.id="api-status",s.className="api-status",n.appendChild(s));const a=t.map((t=>{const e=t.status||"pending";return`\n<div class="api-item ${e}">\n<span class="material-icons">${{success:"check_circle",pending:"autorenew",error:"error"}[e]||"autorenew"}</span>\n<span>${t.name}</span>\n</div>\n`})).join("");s.innerHTML=`\n<div>备用节点状态：</div>\n<div class="api-list">${a}</div>\n`}async function h(){if("#google_vignette"===window.location.hash)return;!function(){const t=l(),e=t.q||"",n=t.site||"",s="GFork 檢索";document.title=e?n?`${e} - ${s}（${n}）`:`${e} - ${s}`:s}();const t=document.getElementById("script-results");if(!t)return void console.error("Results container not found");const e=l();if(!(e.q||e.site||e.page))return t.innerHTML='<div class="error" style="padding: 20px; text-align: center; color: #ff6b6b;">警告：当前未搜索任何内容</div>',void m(!0);t.innerHTML=function(t){let e="<ul>";for(let n=0;n<t;n++)e+=`\n<li class="skeleton-item" id="skeleton-${n}">\n<article>\n<h2>\n<span class="skeleton-title"></span>\n<span class="skeleton-badge"></span>\n<span class="skeleton-separator"></span>\n<span class="skeleton-description"></span>\n</h2>\n<div class="script-meta-block">\n<dl class="inline-script-stats">\n<dt><span>作者</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>日安装量</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>总安装量</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>评分</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>创建于</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>更新于</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n</dl>\n</div>\n</article>\n<div class="loading-overlay">\n<div class="loading-spinner">\n<span class="material-icons">autorenew</span>\n<div class="loading-tip">少女祈祷中…正等待加载脚本。<br>注意：所有结果均来源于网络搜索，可靠性未知，请注意甄别代码以及相关内容,谨防欺诈。</div>\n</div>\n</div>\n</li>`;return e+="</ul>",e}(10);let n=!1;try{const t=await d(a),e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},mode:"cors"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const s=e.headers.get("content-type");if(!s||!s.includes("application/json"))throw new Error("Response is not JSON format");const o=await e.json();n=!0,g(o)}catch(e){console.log("主节点失败，切换到备用节点:",e);const a=Object.keys(s).map((t=>({name:t,status:"pending"})));u(a,!0);const i=o.map((async(t,e)=>{try{const s=await d(t),o=await fetch(s,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},mode:"cors"});if(!o.ok)throw new Error(`HTTP ${o.status}`);const i=o.headers.get("content-type");if(!i||!i.includes("application/json"))throw new Error("Response is not JSON format");const r=await o.json();return n||(n=!0,a[e].status="success",u(a,!0),g(r)),{success:!0,index:e}}catch(t){return a[e].status="error",u(a,!0),{success:!1,index:e,error:t}}}));Promise.all(i).then((e=>{0!==e.filter((t=>t.success)).length||n||(t.innerHTML='<div class="error">所有API请求失败，请稍后重试</div>')}))}}async function g(t){if(!0===t.redirect&&t.target_url)return alert(t.message||"检测到非中文区域，将跳转到 Greasyfork 官方站点"),void(window.location.href=t.target_url);const e=document.getElementById("script-results");if(!e)return;if(!t||0===t.length)return e.innerHTML='<div class="loading">未找到匹配內容</div>',void m(!0);const n=t.length,s=e.querySelector("ul"),a=e.querySelectorAll("li").length;if(n>a&&s)for(let t=a;t<n;t++){const e=document.createElement("li");e.className="skeleton-item",e.id=`skeleton-${t}`,e.innerHTML='\n<article>\n<h2>\n<span class="skeleton-title"></span>\n<span class="skeleton-badge"></span>\n<span class="skeleton-separator"></span>\n<span class="skeleton-description"></span>\n</h2>\n<div class="script-meta-block">\n<dl class="inline-script-stats">\n<dt><span>作者</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>日安装量</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>总安装量</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>评分</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>创建于</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>更新于</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n</dl>\n</div>\n</article>\n<div class="loading-overlay">\n<div class="loading-spinner">\n<span class="material-icons">autorenew</span>\n<div class="loading-tip">少女祈祷中…正等待加载脚本。<br>注意：所有结果均来源于网络搜索，可靠性未知，请注意甄别代码以及相关内容，谨防欺诈。</div>\n</div>\n</div>\n',s.appendChild(e)}t.forEach(((t,e)=>{!function(t,e){const n=document.getElementById(`skeleton-${t}`);if(!n)return;const s=n.querySelector("article");if(!s)return;const a=e.users?.[0]?.name||"未知作者",o=e.created_at?new Date(e.created_at):null,i=e.code_updated_at?new Date(e.code_updated_at):null,r=t=>t?`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`:"未知";s.innerHTML=`\n<h2>\n<a class="script-link" href="#" data-placeholder="true">${e.name||"未命名"}</a>\n<span class="badge badge-js" title="用户脚本">JS</span>\n<span class="name-description-separator">-</span>\n<span class="script-description description">${e.description||"暂无描述"}</span>\n</h2>\n<div class="script-meta-block">\n<dl class="inline-script-stats">\n<dt class="script-list-author"><span>作者</span></dt>\n<dd class="script-list-author"><a href="#" data-placeholder="true">${a}</a></dd>\n<dt class="script-list-daily-installs"><span>日安装量</span></dt>\n<dd class="script-list-daily-installs"><span>${e.daily_installs||0}</span></dd>\n<dt class="script-list-total-installs"><span>总安装量</span></dt>\n<dd class="script-list-total-installs"><span>${e.total_installs||0}</span></dd>\n<dt class="script-list-ratings"><span>评分</span></dt>\n<dd class="script-list-ratings" data-rating-score="${e.fan_score||0}">\n<span>\n<span class="good-rating-count" title="评级为好评或已加入到收藏的人数">${e.good_ratings||0}</span>\n<span class="ok-rating-count" title="评级为一般的人数">${e.ok_ratings||0}</span>\n<span class="bad-rating-count" title="评级为差评的人数">${e.bad_ratings||0}</span>\n</span>\n</dd>\n<dt class="script-list-created-date"><span>创建于</span></dt>\n<dd class="script-list-created-date"><span>${r(o)}</span></dd>\n<dt class="script-list-updated-date"><span>更新于</span></dt>\n<dd class="script-list-updated-date"><span>${r(i)}</span></dd>\n<a href="#" data-placeholder="true">立即安装此脚本</a>\n</dl>\n</div>\n`;const l=n.querySelector(".loading-overlay");l&&l.remove(),n.classList.remove("skeleton-item"),n.classList.add("fade-in"),n.dataset.itemData=JSON.stringify(e)}(e,t)}));for(let t=n;t<100;t++){const e=document.getElementById(`skeleton-${t}`);if(!e)break;e.remove()}const o=[];for(let t=0;t<n;t++)o.push(p(t));if(await Promise.all(o),s){const t=document.createElement("li");t.className="ad-container",t.style.listStyle="none",t.innerHTML='\n<ins class="adsbygoogle" \n style="display:block" \n data-ad-client="ca-pub-3758644447684310" \n data-ad-slot="4095096984" \n data-ad-format="auto" \n data-full-width-responsive="true"></ins>\n',s.insertBefore(t,s.firstChild);try{(window.adsbygoogle=window.adsbygoogle||[]).push({})}catch(t){console.log("AdSense加载失败:",t)}}m(!1)}function f(t){t.preventDefault();const e=document.getElementById("search-submit");if(!e)return void console.error("Search input not found");const n=e.value.trim(),s=new URL(window.location);s.hash=n?`#?q=${encodeURIComponent(n)}`:"#",window.history.pushState({},"",s),h()}function m(t=!1){const e=window.location.hash.substring(2);if(!e)return;const n=new URLSearchParams(e),s=parseInt(n.get("page")||"1"),a=document.getElementById("pagination");if(a){const e=new URLSearchParams(n),o=new URLSearchParams(n),i=new URLSearchParams(n);e.set("page","1");const r=Math.max(s-1,1);o.set("page",r.toString()),i.set("page",(s+1).toString());let l="";l+=`<a href="#?${e.toString()}" ${1===s?'style="visibility:hidden"':""}>回到第一页</a>`,l+=`<a href="#?${o.toString()}" ${1===s?'style="visibility:hidden"':""}>上一页</a>`,l+=`<span class="current">${s}</span>`,l+=t&&s>1?`<a href="#?${i.toString()}" style="visibility:hidden">下一页</a>`:`<a href="#?${i.toString()}">下一页</a>`,a.innerHTML=l}}function w(){const t=l().filter_locale||"0",e=document.getElementById("language-filter");e&&(e.innerHTML=`\n语言筛选：\n<ul>\n<li class="list-option ${"0"===t?"list-current":""}">\n<a href="#" data-filter="0">展示所有语言内容</a>\n</li>\n<li class="list-option ${"1"===t?"list-current":""}">\n<a href="#" data-filter="1">仅展示中文内容</a>\n</li>\n</ul>\n`,e.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault();const n=this.getAttribute("data-filter"),s=l();s.filter_locale=n,Object.keys(s).forEach((t=>{s[t]||delete s[t]}));const a=new URL(window.location.href);a.hash=`#?${new URLSearchParams(s).toString()}`,window.history.pushState({},"",a),e.querySelectorAll(".list-option").forEach((t=>{t.classList.remove("list-current")})),this.parentElement.classList.add("list-current"),h()}))})))}function v(){const t=document.getElementById("search-form");t&&t.addEventListener("submit",f);const e=document.querySelector(".sidebar-search");e&&e.addEventListener("submit",(function(t){t.preventDefault();const n=e.querySelector('input[name="q"]');if(!n)return;const s=l(),a={q:n.value.trim(),sort:s.sort||"",filter_locale:s.filter_locale||"0"};s.site&&(a.site=s.site),Object.keys(a).forEach((t=>{a[t]||delete a[t]}));const o=new URL(window.location.href),i=new URLSearchParams(a).toString();o.hash=i?`#?${i}`:"#",window.history.pushState({},"",o),y(a.sort||""),h()}))}function y(t){const e=document.getElementById("sort-options-list");if(!e)return;const n=e.querySelectorAll(".list-option");n.forEach((t=>{t.classList.remove("list-current")})),n.forEach((e=>{const n=e.querySelector("a");if(n){const s=new URL(n.href,window.location.origin);(new URLSearchParams(s.hash.substring(2)).get("sort")||"")===t&&e.classList.add("list-current")}}))}function k(){const t=l(),e=t.q||"",n=t.sort||"",s=t.filter_locale||"0",a=t.site||"",o=(t.page,document.querySelector('.sidebar-search input[name="q"]'));o&&(o.value=e);const i=[{value:"",text:"相关程度"},{value:"daily_installs",text:"日安装量"},{value:"total_installs",text:"总安装量"},{value:"ratings",text:"得分"},{value:"created",text:"创建日期"},{value:"updated",text:"更新日期"},{value:"name",text:"名称"}],r=document.getElementById("sort-options-list");r&&(r.innerHTML="",i.forEach((t=>{const o=document.createElement("li");o.className="list-option",t.value===n&&o.classList.add("list-current");const i=document.createElement("a");i.textContent=t.text,i.addEventListener("click",(function(n){n.preventDefault();const o=l(),r={q:o.q||e,sort:t.value,filter_locale:o.filter_locale||s};(o.site||a)&&(r.site=o.site||a),o.page&&(r.page=o.page),Object.keys(r).forEach((t=>{r[t]||delete r[t]}));const c=`#?${new URLSearchParams(r).toString()}`;i.href=c,y(t.value),window.history.pushState({},"",c),h()})),o.appendChild(i),r.appendChild(o)})),setTimeout((()=>y(n)),0)),w()}if(window.addEventListener("popstate",(function(){if("#google_vignette"===window.location.hash)return;y(l().sort||""),w(),h()})),window.addEventListener("hashchange",(function(e){if(n)return void(n=!1);const s=window.location.hash,a=e.oldURL?new URL(e.oldURL).hash:"";console.log("Hash changed:",{old:a,new:s,lastValid:t}),"#google_vignette"!==a||r(s)?!r(a)||r(s)||"#google_vignette"===s?"#google_vignette"!==s?r(s)&&console.log("正常hash变化:",s):console.log("进入google_vignette，保持lastValidHash:",t):t&&r(t)&&(console.log("恢复hash从空:",t),n=!0,window.location.hash=t,setTimeout((()=>{h()}),50)):t&&r(t)&&(console.log("恢复hash从google_vignette:",t),n=!0,window.location.hash=t,setTimeout((()=>{h()}),50))})),"loading"===document.readyState)document.addEventListener("DOMContentLoaded",(function(){const e=window.location.hash;r(e)&&(t=e),v(),k(),h()}));else{const e=window.location.hash;r(e)&&(t=e),v(),k(),h()}}();