!function(){const t=!1,e=(...e)=>t,n=(...e)=>t;let a="",s=null,i=null,r=null;const o=[{name:"NODE_AWSP",url:"https://dev-volcengine-auth.netlify.app/gftls",method:"POST"},{name:"NODE_CFWK",url:"https://volcengine-cf-gateway.dahi.edu.eu.org/gftls",method:"POST"},{name:"NODE_AWSS",url:"https://api-edge-sakiko-dispatch-network-aws-nf-cdn.dahi.edu.eu.org/gftls",method:"POST"}],l=[{name:"NODE_ALI",url:"https://web-static-origin.e.yu.ac.cn/gftls",method:"POST"},{name:"NODE_TCT",url:"https://web-static-origin.dahi.edu.cn.dahi.e.yu.ac.cn/gftls",method:"POST"}];async function c(){const t=Math.floor(Date.now()/1e3).toString();return{ss:(await async function(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("")}(t.substring(0,8))).substring(0,9)}}const d={isValid:t=>t&&"#"!==t&&"#?"!==t&&"#google_vignette"!==t,parse(t){const e=t?.startsWith("#?")?t.substring(2):"";return Object.fromEntries(new URLSearchParams(e))},get(){const t=window.location.hash;if(!this.isValid(t))return this.isValid(a)?this.parse(a):{};a=t;const e=this.parse(t);return e.q&&(s=e),e},set(t){const e=Object.fromEntries(Object.entries(t).filter((([t,e])=>e))),n=new URLSearchParams(e).toString(),a=new URL(window.location);a.hash=n?`#?${n}`:"#",window.history.pushState({},"",a)}};function u(){const t=d.get(),{q:e,site:n}=t,s="GFork 檢索";let i=e?`${e} - ${s}${n?`（${n}）`:""}`:s;!d.isValid(window.location.hash)&&d.isValid(a)&&(i+="：历史记录失效"),document.title=i}const p={createLoadingAnimation:()=>'<div class="loading-container" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; min-height: 400px;"><div class="loading-spinner" style="display: flex; flex-direction: column; align-items: center; gap: 20px;"><span class="material-icons" style="font-size: 48px; animation: spin 1s linear infinite;  will-change: transform;">autorenew</span><div class="loading-tip" style="text-align: center; line-height: 1.6; max-width: 500px;">少女祈祷中…正等待加载脚本。<br><small style="font-size: 0.9em;">注意：所有结果均来源于网络搜索，可靠性未知，请注意甄别代码以及相关内容，谨防欺诈。</small></div></div></div><style>@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }</style>',formatDateTime:t=>t?t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/\//g,"-"):"未知",createResultItem(t,e){const n=t.users?.[0]?.name||"未知作者",a=t.users?.[0]?.id||"",s=a?`https://gfork.zh-tw.eu.org/zh-hans/users/${a}`:"#",i=`https://gfork.zh-tw.eu.org/zh-hans/scripts/${t.id}`;let r=t.code_url?.replace("https://update.greasyfork.org/scripts/","/d#/")||"#";const o=t.created_at?new Date(t.created_at):null,l=t.code_updated_at?new Date(t.code_updated_at):null;return`<li class="result-item" data-index="${e}" style="opacity: 0; animation: fadeIn 0.3s ease-out forwards; animation-delay: ${Math.min(.05*e,.5)}s;"><article><h2><a class="script-link" href="${i}" target="_blank" rel="noopener noreferrer">${this.escapeHtml(t.name||"未命名")}</a><span class="badge badge-js" title="用户脚本">JS</span><span class="name-description-separator">-</span><span class="script-description description">${this.escapeHtml(t.description||"暂无描述")}</span></h2><div class="script-meta-block"><dl class="inline-script-stats"><dt class="script-list-author"><span>作者</span></dt><dd class="script-list-author"><a href="${s}" target="_blank" rel="noopener noreferrer">${this.escapeHtml(n)}</a></dd><dt class="script-list-daily-installs"><span>日安装量</span></dt><dd class="script-list-daily-installs"><span>${t.daily_installs||0}</span></dd><dt class="script-list-total-installs"><span>总安装量</span></dt><dd class="script-list-total-installs"><span>${t.total_installs||0}</span></dd><dt class="script-list-ratings"><span>评分</span></dt><dd class="script-list-ratings" data-rating-score="${t.fan_score||0}"><span><span class="good-rating-count" title="评级为好评或已加入到收藏的人数">${t.good_ratings||0}</span><span class="ok-rating-count" title="评级为一般的人数">${t.ok_ratings||0}</span><span class="bad-rating-count" title="评级为差评的人数">${t.bad_ratings||0}</span></span></dd><dt class="script-list-created-date"><span>创建于</span></dt><dd class="script-list-created-date"><span>${this.formatDateTime(o)}</span></dd><dt class="script-list-updated-date"><span>更新于</span></dt><dd class="script-list-updated-date"><span>${this.formatDateTime(l)}</span></dd></dl><div class="install-button-container"><a href="${r}" target="_blank" rel="noopener noreferrer" class="install-button">立即安装此脚本</a></div></div></article></li>`},escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML},updateApiStatus(t,e=!1){const n=document.querySelector("footer");if(!n)return;let a=document.getElementById("api-status");if(!e)return void a?.remove();a||(a=document.createElement("div"),a.id="api-status",a.className="api-status",n.appendChild(a));const s={success:"check_circle",pending:"autorenew",error:"error"},i=t.map((t=>`<div class="api-item ${t.status||"pending"}"><span class="material-icons">${s[t.status]||"autorenew"}</span><span>${t.name}</span></div>`)).join("");a.innerHTML=`<div>备用节点状态：</div><div class="api-list">${i}</div>`}};async function m(t,a,s=5e3){try{const n=await async function(t){const e={...d.get()};delete e.locale;const{ss:n}=await c();if("POST"===t.method){const a=new URLSearchParams(e).toString();return{url:`${t.url}/${n}`,options:{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},body:a,mode:"cors"}}}e.ss=n;const a=new URLSearchParams(e).toString();return{url:a?`${t.url}?${a}`:t.url,options:{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},mode:"cors"}}}(t);n.options.signal=a;const i=new Promise(((t,e)=>setTimeout((()=>e(new Error("Timeout"))),s))),r=fetch(n.url,n.options),o=await Promise.race([r,i]);if(!o.ok)throw new Error(`HTTP ${o.status}`);const l=await async function(t){if("base64"===t.headers.get("X-Content-Encoding")){const e=await t.text(),n=atob(e),a=new Uint8Array(n.length);for(let t=0;t<n.length;t++)a[t]=n.charCodeAt(t);const s=new TextDecoder("utf-8").decode(a);return JSON.parse(s)}return await t.json()}(o);return e(t.name),{success:!0,data:l,node:t}}catch(e){return"AbortError"!==e.name&&n(t.name,e.message),{success:!1,error:e,node:t}}}async function g(t,e){return new Promise((n=>{let a=!1,s=0;const i=[];t.forEach((async r=>{const o=await m(r,e);a||(s++,o.success?(a=!0,n({success:!0,data:o.data,node:o.node})):(i.push(o.node.name),s===t.length&&(a=!0,n({success:!1,failedNodes:i,message:`所有节点请求失败: ${i.join(", ")}`}))))}))}))}async function h(){if("#google_vignette"===window.location.hash)return;r&&(cancelAnimationFrame(r),r=null),u();const t=document.getElementById("script-results");if(!t)return;const a=d.get();if(!a.q&&!a.site&&!a.page)return t.innerHTML='<div class="error" style="padding: 20px; text-align: center;">警告：当前未搜索任何内容</div>',void w(!0);i?.abort(),i=new AbortController,t.innerHTML=p.createLoadingAnimation(),e();const s=await g(o,i.signal);if(s.success)return e(s.node.name),void f(s.data);e(),n(s.message);const c=await g(l,i.signal);c.success?(e(c.node.name),f(c.data)):(n(),n(c.message),t.innerHTML='<div class="error" style="padding: 40px; text-align: center;"><h3 style=" margin-bottom: 16px;">所有API请求失败</h3><p>请检查网络连接或稍后重试</p></div>')}function f(t){if(t.redirect&&t.target_url)return alert(t.message||"检测到非中文区域，将跳转到 Greasyfork Official Site"),void(window.location.href=t.target_url);const e=document.getElementById("script-results");return e?t?.length?void(r=requestAnimationFrame((()=>{!function(t,e){const n=document.createDocumentFragment(),a=document.createElement("ul");t.forEach(((t,e)=>{const n=document.createElement("div");n.innerHTML=p.createResultItem(t,e),a.appendChild(n.firstElementChild)})),n.appendChild(a),e.innerHTML="",e.appendChild(n)}(t,e),w(!1)}))):(e.innerHTML='<div class="loading">未找到匹配內容</div>',void w(!0)):void 0}function w(t=!1){const e=d.get(),n=parseInt(e.page||"1"),a=document.getElementById("pagination");if(!a)return;const s=(t,n,a=!1)=>{const s={...e,page:t.toString()};return`<a href="#?${new URLSearchParams(s).toString()}" target="_blank" ${a?'style="visibility:hidden"':""}>${n}</a>`};a.innerHTML=`${s(1,"回到第一页",1===n)} ${s(Math.max(n-1,1),"上一页",1===n)} <span class="current">${n}</span> ${s(n+1,"下一页",t&&n>1)}`,a.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault(),window.open(t.href,"_blank")}))}))}function v(){const t=d.get().filter_locale||"0",e=document.getElementById("language-filter");if(!e)return;e.innerHTML=`语言筛选：<ul>${[{value:"0",text:"展示所有语言内容"},{value:"1",text:"仅展示中文内容"}].map((e=>`<li class="list-option ${t===e.value?"list-current":""}"><a href="#" data-filter="${e.value}">${e.text}</a></li>`)).join("")}</ul>`,e.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault();const n=d.get();n.filter_locale=t.dataset.filter,d.set(n),window.open(window.location.href,"_blank")}))}))}function y(){const t=window.location.hash;d.isValid(t)&&(a=t),function(){const t=document.getElementById("search-form");t?.addEventListener("submit",(t=>{t.preventDefault();const e=document.getElementById("search-submit");if(!e)return;const n=e.value.trim();n&&(d.set({q:n}),window.open(window.location.href,"_blank"))}));const e=document.querySelector(".sidebar-search");e?.addEventListener("submit",(t=>{t.preventDefault();const n=e.querySelector('input[name="q"]');if(!n)return;const a=n.value.trim();if(!a)return;const s=d.get(),i={q:a,sort:s.sort||"",filter_locale:s.filter_locale||"0",...s.site&&{site:s.site}};d.set(i),window.open(window.location.href,"_blank")}))}(),function(){const t=d.get(),e=document.querySelector('.sidebar-search input[name="q"]');e&&(e.value=t.q||"");const n=[{value:"",text:"相关程度"},{value:"daily_installs",text:"日安装量"},{value:"total_installs",text:"总安装量"},{value:"ratings",text:"得分"},{value:"created",text:"创建日期"},{value:"updated",text:"更新日期"},{value:"name",text:"名称"}],a=document.getElementById("sort-options-list");a&&(a.innerHTML=n.map((e=>`<li class="list-option ${e.value===(t.sort||"")?"list-current":""}"><a href="#" data-sort="${e.value}">${e.text}</a></li>`)).join(""),a.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault();const n=d.get();n.sort=t.dataset.sort,d.set(n),window.open(window.location.href,"_blank")}))}))),v()}(),h(),e(),e()}window.addEventListener("popstate",function(t,e){let n;return function(...a){clearTimeout(n),n=setTimeout((()=>{clearTimeout(n),t(...a)}),e)}}((()=>{"#google_vignette"!==window.location.hash&&(v(),u(),h())}),100)),window.addEventListener("hashchange",(t=>{u();const e=window.location.hash;"#google_vignette"!==e&&d.isValid(e)&&(a=e)})),document.addEventListener("visibilitychange",(()=>{document.hidden&&i&&i.abort()})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y):y()}();