!function(){const t=!1,e=(...e)=>t,n=(...e)=>t;let s="",a=null,i=null;const r={primary:[{name:"NODE_AWSP",url:"https://dev-volcengine-auth.netlify.app/gftls",method:"POST"},{name:"NODE_CFWK",url:"https://volcengine-cf-gateway.dahi.edu.eu.org/gftls",method:"POST"},{name:"NODE_AWSS",url:"https://api-edge-sakiko-dispatch-network-aws-nf-cdn.dahi.edu.eu.org/gftls",method:"POST"}],backup:[{name:"NODE_ALI",url:"https://web-static-origin.e.yu.ac.cn/gftls",method:"POST"},{name:"NODE_TCT",url:"https://web-static-origin.dahi.edu.cn.dahi.e.yu.ac.cn/gftls",method:"POST"}]};async function o(){const t=Math.floor(Date.now()/1e3).toString();return{ss:(await async function(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("")}(t.substring(0,8))).substring(0,9)}}const l={isValid:t=>t&&"#"!==t&&"#?"!==t&&"#google_vignette"!==t,parse(t){const e=t?.startsWith("#?")?t.substring(2):"";return Object.fromEntries(new URLSearchParams(e))},get(){const t=window.location.hash;if(!this.isValid(t))return this.isValid(s)?this.parse(s):{};s=t;const e=this.parse(t);return e.q&&(a=e),e},set(t){const e=Object.fromEntries(Object.entries(t).filter((([t,e])=>e))),n=new URLSearchParams(e).toString(),s=new URL(window.location);s.hash=n?`#?${n}`:"#",window.history.pushState({},"",s)}};function c(){const t=l.get(),{q:e,site:n}=t,a="GFork 檢索";let i=e?`${e} - ${a}${n?`（${n}）`:""}`:a;!l.isValid(window.location.hash)&&l.isValid(s)&&(i+="：搜索参数已丢失"),document.title=i}const d={createLoadingAnimation:()=>'\n<div class="loading-container" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; min-height: 400px;">\n<div class="loading-spinner" style="display: flex; flex-direction: column; align-items: center; gap: 20px;">\n<span class="material-icons" style="font-size: 48px; animation: spin 1s linear infinite; color: #4285f4;">autorenew</span>\n<div class="loading-tip" style="text-align: center; color: #666; line-height: 1.6;">\n少女祈祷中…正等待加载脚本。<br>\n注意：所有结果均来源于网络搜索，可靠性未知，请注意甄别代码以及相关内容，谨防欺诈。\n</div>\n</div>\n</div>\n<style>\n@keyframes spin {\nfrom { transform: rotate(0deg); }\nto { transform: rotate(360deg); }\n}\n</style>\n',formatDateTime:t=>t?t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/\//g,"-"):"未知",createResultItem(t){const e=t.users?.[0]?.name||"未知作者",n=t.users?.[0]?.id||"",s=n?`https://gfork.zh-tw.eu.org/zh-hans/users/${n}`:"#",a=`https://gfork.zh-tw.eu.org/zh-hans/scripts/${t.id}`;let i=t.code_url?.replace("https://update.greasyfork.org/scripts/","/d#/")||"#";const r=t.created_at?new Date(t.created_at):null,o=t.code_updated_at?new Date(t.code_updated_at):null;return`\n<li class="result-item">\n<article>\n<h2>\n<a class="script-link" href="${a}" target="_blank">${t.name||"未命名"}</a>\n<span class="badge badge-js" title="用户脚本">JS</span>\n<span class="name-description-separator">-</span>\n<span class="script-description description">${t.description||"暂无描述"}</span>\n</h2>\n<div class="script-meta-block">\n<dl class="inline-script-stats">\n<dt class="script-list-author"><span>作者</span></dt>\n<dd class="script-list-author"><a href="${s}">${e}</a></dd>\n<dt class="script-list-daily-installs"><span>日安装量</span></dt>\n<dd class="script-list-daily-installs"><span>${t.daily_installs||0}</span></dd>\n<dt class="script-list-total-installs"><span>总安装量</span></dt>\n<dd class="script-list-total-installs"><span>${t.total_installs||0}</span></dd>\n<dt class="script-list-ratings"><span>评分</span></dt>\n<dd class="script-list-ratings" data-rating-score="${t.fan_score||0}">\n<span>\n<span class="good-rating-count" title="评级为好评或已加入到收藏的人数">${t.good_ratings||0}</span>\n<span class="ok-rating-count" title="评级为一般的人数">${t.ok_ratings||0}</span>\n<span class="bad-rating-count" title="评级为差评的人数">${t.bad_ratings||0}</span>\n</span>\n</dd>\n<dt class="script-list-created-date"><span>创建于</span></dt>\n<dd class="script-list-created-date"><span>${this.formatDateTime(r)}</span></dd>\n<dt class="script-list-updated-date"><span>更新于</span></dt>\n<dd class="script-list-updated-date"><span>${this.formatDateTime(o)}</span></dd>\n<a href="${i}" target="_blank">立即安装此脚本</a>\n</dl>\n</div>\n</article>\n</li>\n`},updateApiStatus(t,e=!1){const n=document.querySelector("footer");if(!n)return;let s=document.getElementById("api-status");if(!e)return void s?.remove();s||(s=document.createElement("div"),s.id="api-status",s.className="api-status",n.appendChild(s));const a={success:"check_circle",pending:"autorenew",error:"error"},i=t.map((t=>`\n<div class="api-item ${t.status||"pending"}">\n<span class="material-icons">${a[t.status]||"autorenew"}</span>\n<span>${t.name}</span>\n</div>\n`)).join("");s.innerHTML=`\n<div>备用节点状态：</div>\n<div class="api-list">${i}</div>\n`}};async function u(t,s,a=8e3){const i=new AbortController,r=setTimeout((()=>i.abort()),a),c=function(t){const e=new AbortController;for(const n of t){if(n.aborted){e.abort();break}n.addEventListener("abort",(()=>e.abort()),{once:!0})}return e.signal}([s,i.signal]);try{const n=await async function(t){const e={...l.get()};delete e.locale;const{ss:n}=await o();if("POST"===t.method){const s=new URLSearchParams(e).toString();return{url:`${t.url}/${n}`,options:{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},body:s,mode:"cors"}}}e.ss=n;const s=new URLSearchParams(e).toString();return{url:s?`${t.url}?${s}`:t.url,options:{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},mode:"cors"}}}(t);n.options.signal=c;const s=await fetch(n.url,n.options);if(clearTimeout(r),!s.ok)throw new Error(`HTTP ${s.status}`);const a=await async function(t){if("base64"===t.headers.get("X-Content-Encoding")){const e=await t.text(),n=atob(e),s=new Uint8Array(n.length);for(let t=0;t<n.length;t++)s[t]=n.charCodeAt(t);const a=new TextDecoder("utf-8").decode(s);return JSON.parse(a)}return await t.json()}(s);return e(t.name),{success:!0,data:a,node:t}}catch(e){return clearTimeout(r),"AbortError"!==e.name&&n(t.name,e.message),{success:!1,error:e,node:t}}}async function p(){if("#google_vignette"===window.location.hash)return;c();const t=document.getElementById("script-results");if(!t)return;const s=l.get();if(!s.q&&!s.site&&!s.page)return t.innerHTML='<div class="error" style="padding: 20px; text-align: center; color: #ff6b6b;">警告：当前未搜索任何内容</div>',void g(!0);i?.abort(),i=new AbortController,t.innerHTML=d.createLoadingAnimation(),e();const a=[...r.primary,...r.backup],o=await async function(t,n){return new Promise((s=>{let a=!1;const i=[],r=t.map((t=>{const e=u(t,n);return i.push(e),e}));r.forEach((async t=>{try{const n=await t;if(a)return;n.success&&(a=!0,e(n.node.name),s({success:!0,data:n.data,node:n.node}))}catch(t){}})),Promise.all(r).then((e=>{if(a)return;const n=e.filter((t=>!t.success)).map((t=>t.node.name));n.length===t.length&&(a=!0,s({success:!1,failedNodes:n,message:`所有节点请求失败: ${n.join(", ")}`}))}))}))}(a,i.signal);o.success?(e(o.node.name),function(t){if(t.redirect&&t.target_url)return alert(t.message||"检测到非中文区域，将跳转到 Greasyfork Official Site"),void(window.location.href=t.target_url);const e=document.getElementById("script-results");if(!e)return;if(!t?.length)return e.innerHTML='<div class="loading">未找到匹配內容</div>',void g(!0);const n=t.map(((t,e)=>d.createResultItem(t))).join("");e.innerHTML=`<ul>${n}</ul>`,g(!1)}(o.data)):(n(),n(o.message),t.innerHTML=`\n<div class="error" style="padding: 40px; text-align: center;">\n<h3 style="color: #ff6b6b; margin-bottom: 16px;">所有API请求失败</h3>\n<p style="color: #666; margin-bottom: 20px;">失败节点: ${o.failedNodes.join(", ")}</p>\n<p style="color: #999;">请检查网络连接或稍后重试</p>\n</div>\n`)}function g(t=!1){const e=l.get(),n=parseInt(e.page||"1"),s=document.getElementById("pagination");if(!s)return;const a=(t,n,s=!1)=>{const a={...e,page:t.toString()};return`<a href="#?${new URLSearchParams(a).toString()}" ${s?'style="visibility:hidden"':""}>${n}</a>`};s.innerHTML=`\n${a(1,"回到第一页",1===n)}\n${a(Math.max(n-1,1),"上一页",1===n)}\n<span class="current">${n}</span>\n${a(n+1,"下一页",t&&n>1)}\n`}function m(){const t=l.get().filter_locale||"0",e=document.getElementById("language-filter");if(!e)return;e.innerHTML=`\n语言筛选：\n<ul>\n${[{value:"0",text:"展示所有语言内容"},{value:"1",text:"仅展示中文内容"}].map((e=>`\n<li class="list-option ${t===e.value?"list-current":""}">\n<a href="#" data-filter="${e.value}">${e.text}</a>\n</li>\n`)).join("")}\n</ul>\n`,e.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(n=>{n.preventDefault();const s=l.get();s.filter_locale=t.dataset.filter,l.set(s),e.querySelectorAll(".list-option").forEach((t=>t.classList.remove("list-current"))),t.parentElement.classList.add("list-current"),p()}))}))}function h(){const t=window.location.hash;l.isValid(t)&&(s=t),function(){const t=document.getElementById("search-form");t?.addEventListener("submit",(t=>{t.preventDefault();const e=document.getElementById("search-submit");if(!e)return;const n=e.value.trim();l.set({q:n}),p()}));const e=document.querySelector(".sidebar-search");e?.addEventListener("submit",(t=>{t.preventDefault();const n=e.querySelector('input[name="q"]');if(!n)return;const s=l.get();l.set({q:n.value.trim(),sort:s.sort||"",filter_locale:s.filter_locale||"0",...s.site&&{site:s.site}}),p()}))}(),function(){const t=l.get(),e=document.querySelector('.sidebar-search input[name="q"]');e&&(e.value=t.q||"");const n=[{value:"",text:"相关程度"},{value:"daily_installs",text:"日安装量"},{value:"total_installs",text:"总安装量"},{value:"ratings",text:"得分"},{value:"created",text:"创建日期"},{value:"updated",text:"更新日期"},{value:"name",text:"名称"}],s=document.getElementById("sort-options-list");s&&(s.innerHTML=n.map((e=>`\n<li class="list-option ${e.value===(t.sort||"")?"list-current":""}">\n<a href="#" data-sort="${e.value}">${e.text}</a>\n</li>\n`)).join(""),s.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault();const n=l.get();n.sort=t.dataset.sort,l.set(n),s.querySelectorAll(".list-option").forEach((e=>e.classList.toggle("list-current",e.contains(t)))),p()}))}))),m()}(),p()}window.addEventListener("popstate",(()=>{"#google_vignette"!==window.location.hash&&(m(),c(),p())})),window.addEventListener("hashchange",(t=>{c();const e=window.location.hash;"#google_vignette"!==e&&l.isValid(e)&&(s=e)})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h()}();