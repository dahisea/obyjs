!function(){let t="",n=null;const e={NODE_A:"https://api-edge-sakiko-dispatch-network-aws-nf-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",NODE_B:"https://tencent.api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",NODE_C:"https://api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",NODE_D:"https://dev-volcengine-auth.netlify.app/318895e9-64a7-4441-9ee4-625cae200f9b"},s=Object.values({NODE_M:"https://web-static-origin.dahi.edu.cn.dahi.e.yu.ac.cn/img/banner/pc.jpg"})[0],a=Object.values(e);async function i(){const t=Math.floor(Date.now()/1e3).toString().substring(0,8);return{ss:(await async function(t){const n=(new TextEncoder).encode(t),e=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(e)).map((t=>t.toString(16).padStart(2,"0"))).join("")}(t)).substring(0,9)}}function o(){const e=window.location.hash;if("#google_vignette"===e)return r(t);if((!e||"#"===e||"#?"===e)&&t&&"#"!==t&&"#?"!==t)return window.location.hash=t,r(t);if(e&&"#google_vignette"!==e&&"#"!==e&&"#?"!==e){t=e;const s=r(e);s.q&&(n=s)}return r(e)}function r(t){const n=t.startsWith("#?")?t.substring(2):"",e=new URLSearchParams(n),s={};for(const[t,n]of e.entries())s[t]=n;return s}async function l(t){const n=o();delete n.locale;const e=await i();n.ss=e.ss;const s=Object.keys(n).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(n[t])}`)).join("&");return s?`${t}?${s}`:t}async function c(t){return new Promise((n=>{requestAnimationFrame((()=>{const e=document.getElementById(`skeleton-${t}`);if(!e)return void n();const s=JSON.parse(e.dataset.itemData||"{}"),a=e.querySelector("article");if(!a||!s.id)return void n();const i=s.users?.[0]?.id||"",o=i?`https://gfork.zh-tw.eu.org/zh-hans/users/${i}`:"#",r=`https://gfork.zh-tw.eu.org/zh-hans/scripts/${s.id}`;let l=s.code_url||"#";l.includes("update.greasyfork.org/scripts/")&&(l=l.replace("https://update.greasyfork.org/scripts/","/d#/")),a.querySelectorAll('a[data-placeholder="true"]').forEach((t=>{t.classList.contains("script-link")?(t.href=r,t.target="_blank"):t.parentElement.classList.contains("script-list-author")?t.href=o:t.textContent.includes("立即安装")&&(t.href=l,t.target="_blank"),t.removeAttribute("data-placeholder")})),n()}))}))}function d(t,n=!1){const e=document.querySelector("footer");if(!e)return;let s=document.getElementById("api-status");if(!n)return void(s&&s.remove());s||(s=document.createElement("div"),s.id="api-status",s.className="api-status",e.appendChild(s));const a=t.map((t=>{const n=t.status||"pending";return`\n<div class="api-item ${n}">\n<span class="material-icons">${{success:"check_circle",pending:"autorenew",error:"error"}[n]||"autorenew"}</span>\n<span>${t.name}</span>\n</div>\n`})).join("");s.innerHTML=`\n<div>备用节点状态：</div>\n<div class="api-list">${a}</div>\n`}async function p(){if("#google_vignette"===window.location.hash)return;!function(){const t=o(),n=t.q||"",e=t.site||"",s="GFork 檢索";document.title=n?e?`${n} - ${s}（${e}）`:`${n} - ${s}`:s}();const t=document.getElementById("script-results");if(!t)return void console.error("Results container not found");const n=o();if(!(n.q||n.site||n.page))return t.innerHTML='<div class="error" style="padding: 20px; text-align: center; color: #ff6b6b;">警告：当前未搜索任何内容</div>',void f(!0);t.innerHTML=function(t){let n="<ul>";for(let e=0;e<t;e++)n+=`\n<li class="skeleton-item" id="skeleton-${e}">\n<article>\n<h2>\n<span class="skeleton-title"></span>\n<span class="skeleton-badge"></span>\n<span class="skeleton-separator"></span>\n<span class="skeleton-description"></span>\n</h2>\n<div class="script-meta-block">\n<dl class="inline-script-stats">\n<dt><span>作者</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>日安装量</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>总安装量</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>评分</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>创建于</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>更新于</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n</dl>\n</div>\n</article>\n<div class="loading-overlay">\n<div class="loading-spinner">\n<span class="material-icons">autorenew</span>\n<div class="loading-tip">少女祈祷中…正等待加载脚本。<br>注意：所有结果均来源于网络搜索，可靠性未知，请注意甄别代码以及相关内容，谨防欺诈。</div>\n</div>\n</div>\n</li>`;return n+="</ul>",n}(10);let i=!1;try{const t=await l(s),n=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},mode:"cors"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const e=n.headers.get("content-type");if(!e||!e.includes("application/json"))throw new Error("Response is not JSON format");const a=await n.json();i=!0,u(a)}catch(n){console.log("主节点失败，切换到备用节点:",n);const s=Object.keys(e).map((t=>({name:t,status:"pending"})));d(s,!0);const o=a.map((async(t,n)=>{try{const e=await l(t),a=await fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},mode:"cors"});if(!a.ok)throw new Error(`HTTP ${a.status}`);const o=a.headers.get("content-type");if(!o||!o.includes("application/json"))throw new Error("Response is not JSON format");const r=await a.json();return i||(i=!0,s[n].status="success",d(s,!0),u(r)),{success:!0,index:n}}catch(t){return s[n].status="error",d(s,!0),{success:!1,index:n,error:t}}}));Promise.all(o).then((n=>{0!==n.filter((t=>t.success)).length||i||(t.innerHTML='<div class="error">所有API请求失败，请稍后重试</div>')}))}}async function u(t){if(!0===t.redirect&&t.target_url)return alert(t.message||"检测到非中文区域，将跳转到 Greasyfork 官方站点"),void(window.location.href=t.target_url);const n=document.getElementById("script-results");if(!n)return;if(!t||0===t.length)return n.innerHTML='<div class="loading">未找到匹配內容</div>',void f(!0);const e=t.length,s=n.querySelector("ul"),a=n.querySelectorAll("li").length;if(e>a&&s)for(let t=a;t<e;t++){const n=document.createElement("li");n.className="skeleton-item",n.id=`skeleton-${t}`,n.innerHTML='\n<article>\n<h2>\n<span class="skeleton-title"></span>\n<span class="skeleton-badge"></span>\n<span class="skeleton-separator"></span>\n<span class="skeleton-description"></span>\n</h2>\n<div class="script-meta-block">\n<dl class="inline-script-stats">\n<dt><span>作者</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>日安装量</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>总安装量</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>评分</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>创建于</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n<dt><span>更新于</span></dt>\n<dd><span class="skeleton-text"></span></dd>\n</dl>\n</div>\n</article>\n<div class="loading-overlay">\n<div class="loading-spinner">\n<span class="material-icons">autorenew</span>\n<div class="loading-tip">少女祈祷中…正等待加载脚本。注意：所有结果均来源于网络搜索，可靠性未知，请注意甄别代码以及相关内容，谨防欺诈。</div>\n</div>\n</div>\n',s.appendChild(n)}t.forEach(((t,n)=>{!function(t,n){const e=document.getElementById(`skeleton-${t}`);if(!e)return;const s=e.querySelector("article");if(!s)return;const a=n.users?.[0]?.name||"未知作者",i=n.created_at?new Date(n.created_at):null,o=n.code_updated_at?new Date(n.code_updated_at):null,r=t=>t?`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`:"未知";s.innerHTML=`\n<h2>\n<a class="script-link" href="#" data-placeholder="true">${n.name||"未命名"}</a>\n<span class="badge badge-js" title="用户脚本">JS</span>\n<span class="name-description-separator">-</span>\n<span class="script-description description">${n.description||"暂无描述"}</span>\n</h2>\n<div class="script-meta-block">\n<dl class="inline-script-stats">\n<dt class="script-list-author"><span>作者</span></dt>\n<dd class="script-list-author"><a href="#" data-placeholder="true">${a}</a></dd>\n<dt class="script-list-daily-installs"><span>日安装量</span></dt>\n<dd class="script-list-daily-installs"><span>${n.daily_installs||0}</span></dd>\n<dt class="script-list-total-installs"><span>总安装量</span></dt>\n<dd class="script-list-total-installs"><span>${n.total_installs||0}</span></dd>\n<dt class="script-list-ratings"><span>评分</span></dt>\n<dd class="script-list-ratings" data-rating-score="${n.fan_score||0}">\n<span>\n<span class="good-rating-count" title="评级为好评或已加入到收藏的人数">${n.good_ratings||0}</span>\n<span class="ok-rating-count" title="评级为一般的人数">${n.ok_ratings||0}</span>\n<span class="bad-rating-count" title="评级为差评的人数">${n.bad_ratings||0}</span>\n</span>\n</dd>\n<dt class="script-list-created-date"><span>创建于</span></dt>\n<dd class="script-list-created-date"><span>${r(i)}</span></dd>\n<dt class="script-list-updated-date"><span>更新于</span></dt>\n<dd class="script-list-updated-date"><span>${r(o)}</span></dd>\n<a href="#" data-placeholder="true">立即安装此脚本</a>\n</dl>\n</div>\n`;const l=e.querySelector(".loading-overlay");l&&l.remove(),e.classList.remove("skeleton-item"),e.classList.add("fade-in"),e.dataset.itemData=JSON.stringify(n)}(n,t)}));for(let t=e;t<100;t++){const n=document.getElementById(`skeleton-${t}`);if(!n)break;n.remove()}const i=[];for(let t=0;t<e;t++)i.push(c(t));if(await Promise.all(i),s){const t=document.createElement("li");t.className="ad-container",t.style.listStyle="none",t.innerHTML='\n<ins class="adsbygoogle" \n style="display:block" \n data-ad-client="ca-pub-3758644447684310" \n data-ad-slot="4095096984" \n data-ad-format="auto" \n data-full-width-responsive="true"></ins>\n',s.insertBefore(t,s.firstChild);try{(window.adsbygoogle=window.adsbygoogle||[]).push({})}catch(t){console.log("AdSense加载失败:",t)}}f(!1)}function h(t){t.preventDefault();const n=document.getElementById("search-submit");if(!n)return void console.error("Search input not found");const e=n.value.trim(),s=new URL(window.location);s.hash=e?`#?q=${encodeURIComponent(e)}`:"#",window.history.pushState({},"",s),p()}function f(t=!1){const n=window.location.hash.substring(2);if(!n)return;const e=new URLSearchParams(n),s=parseInt(e.get("page")||"1"),a=document.getElementById("pagination");if(a){const n=new URLSearchParams(e),i=new URLSearchParams(e),o=new URLSearchParams(e);n.set("page","1");const r=Math.max(s-1,1);i.set("page",r.toString()),o.set("page",(s+1).toString());let l="";l+=`<a href="#?${n.toString()}" ${1===s?'style="visibility:hidden"':""}>回到第一页</a>`,l+=`<a href="#?${i.toString()}" ${1===s?'style="visibility:hidden"':""}>上一页</a>`,l+=`<span class="current">${s}</span>`,l+=t&&s>1?`<a href="#?${o.toString()}" style="visibility:hidden">下一页</a>`:`<a href="#?${o.toString()}">下一页</a>`,a.innerHTML=l}}function g(){const t=o().filter_locale||"0",n=document.getElementById("language-filter");n&&(n.innerHTML=`\n语言筛选：\n<ul>\n<li class="list-option ${"0"===t?"list-current":""}">\n<a href="#" data-filter="0">展示所有语言内容</a>\n</li>\n<li class="list-option ${"1"===t?"list-current":""}">\n<a href="#" data-filter="1">仅展示中文内容</a>\n</li>\n</ul>\n`,n.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault();const e=this.getAttribute("data-filter"),s=o();s.filter_locale=e,Object.keys(s).forEach((t=>{s[t]||delete s[t]}));const a=new URL(window.location.href);a.hash=`#?${new URLSearchParams(s).toString()}`,window.history.pushState({},"",a),n.querySelectorAll(".list-option").forEach((t=>{t.classList.remove("list-current")})),this.parentElement.classList.add("list-current"),p()}))})))}function m(){const t=document.getElementById("search-form");t&&t.addEventListener("submit",h);const n=document.querySelector(".sidebar-search");n&&n.addEventListener("submit",(function(t){t.preventDefault();const e=n.querySelector('input[name="q"]');if(!e)return;const s=o(),a={q:e.value.trim(),sort:s.sort||"",filter_locale:s.filter_locale||"0"};s.site&&(a.site=s.site),Object.keys(a).forEach((t=>{a[t]||delete a[t]}));const i=new URL(window.location.href),r=new URLSearchParams(a).toString();i.hash=r?`#?${r}`:"#",window.history.pushState({},"",i),w(a.sort||""),p()}))}function w(t){const n=document.getElementById("sort-options-list");if(!n)return;const e=n.querySelectorAll(".list-option");e.forEach((t=>{t.classList.remove("list-current")})),e.forEach((n=>{const e=n.querySelector("a");if(e){const s=new URL(e.href,window.location.origin);(new URLSearchParams(s.hash.substring(2)).get("sort")||"")===t&&n.classList.add("list-current")}}))}function v(){const t=o(),n=t.q||"",e=t.sort||"",s=t.filter_locale||"0",a=t.site||"",i=document.querySelector('.sidebar-search input[name="q"]');i&&(i.value=n);const r=[{value:"",text:"相关程度"},{value:"daily_installs",text:"日安装量"},{value:"total_installs",text:"总安装量"},{value:"ratings",text:"得分"},{value:"created",text:"创建日期"},{value:"updated",text:"更新日期"},{value:"name",text:"名称"}],l=document.getElementById("sort-options-list");l&&(l.innerHTML="",r.forEach((t=>{const i=document.createElement("li");i.className="list-option",t.value===e&&i.classList.add("list-current");const o=document.createElement("a"),r={q:n,sort:t.value,filter_locale:s};a&&(r.site=a),Object.keys(r).forEach((t=>{r[t]||delete r[t]})),o.href=`#?${new URLSearchParams(r).toString()}`,o.textContent=t.text,o.addEventListener("click",(function(n){n.preventDefault(),w(t.value),window.history.pushState({},"",this.href),p()})),i.appendChild(o),l.appendChild(i)})),setTimeout((()=>w(e)),0)),g()}window.addEventListener("popstate",(function(){if("#google_vignette"===window.location.hash)return;w(o().sort||""),g(),p()})),window.addEventListener("hashchange",(function(){const n=window.location.hash;""!==n&&"#"!==n&&"#?"!==n||t&&"#"!==t&&"#?"!==t&&(window.location.hash=t)})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){m(),v(),p()})):(m(),v(),p())}();