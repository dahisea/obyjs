!function(){let t="";const e={NODE_M:"https://web-static-origin.dahi.edu.cn.dahi.e.yu.ac.cn/img/banner/pc.jpg",NODE_A:"https://api-edge-sakiko-dispatch-network-aws-nf-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",NODE_B:"https://tencent.api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",NODE_C:"https://api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",NODE_D:"https://dev-volcengine-auth.netlify.app/318895e9-64a7-4441-9ee4-625cae200f9b"},n=Object.values(e),s=n[0];async function a(){const t=Math.floor(Date.now()/1e3).toString().substring(0,8);return{ss:(await async function(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("")}(t)).substring(0,9)}}function i(){const e=window.location.hash;return"#google_vignette"===e?(console.log("Detected google_vignette, using last valid hash:",t),o(t)):(e&&"#google_vignette"!==e&&(t=e),o(e))}function o(t){const e=t.startsWith("#?")?t.substring(2):"",n=new URLSearchParams(e),s={};for(const[t,e]of n.entries())s[t]=e;return s}async function r(t){const e=i();delete e.locale;const n=await a();e.ss=n.ss;const s=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&");return s?`${t}?${s}`:t}function c(t=1){let e="<ul>";for(let n=0;n<t;n++)e+=`\n<li class="skeleton-item" id="skeleton-${n}">\n<article>\n<div class="skeleton-title"></div>\n<div class="skeleton-description"></div>\n</article>\n<div class="loading-overlay">\n<div class="loading-spinner">\n<span class="material-icons">autorenew</span>\n<div class="loading-tip">少女祈祷中…正等待加载脚本。注意：所有结果均来源于网络搜索，可靠性未知，请注意甄别代码以及相关内容，谨防欺诈。</div>\n</div>\n</div>\n</li>`;return e+="</ul>",e}function l(t){const n=document.querySelector("footer");if(!n)return;let s=document.getElementById("api-status");s||(s=document.createElement("div"),s.id="api-status",s.className="api-status",n.appendChild(s));const a=Object.keys(e),i=t.map(((t,e)=>{const n=t.status||"pending";return`\n<div class="api-item ${n}">\n<span class="material-icons">${{success:"check_circle",pending:"autorenew",error:"error"}[n]||"autorenew"}</span>\n<span>${a[e]||`NODE_${e}`}</span>\n</div>\n`})).join("");s.innerHTML=`\n<div>API 端点状态：</div>\n<div class="api-list">${i}</div>\n`}async function d(){if("#google_vignette"===window.location.hash)return void console.log("Skipping reload for google_vignette");!function(){const t=i(),e=t.q||"",n=t.site||"",s="GFork 檢索";document.title=e?n?`${e} - ${s}（${n}）`:`${e} - ${s}`:s}();const t=document.getElementById("script-results");if(!t)return void console.error("Results container not found");t.innerHTML=c(1);const e=n.map(((t,e)=>({url:t,status:0===e?"pending":"idle"})));l(e);let a=!1;try{const t=await r(s),n=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},mode:"cors"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const i=n.headers.get("content-type");if(!i||!i.includes("application/json"))throw new Error("Response is not JSON format");const o=await n.json();a=!0,e[0].status="success",l(e),u(o)}catch(s){console.log("NODE_CHINA failed, trying other nodes:",s),e[0].status="error";const i=n.slice(1);e.forEach(((t,e)=>{e>0&&(t.status="pending")})),l(e);const o=i.map((async(t,n)=>{const s=n+1;try{const n=await r(t),i=await fetch(n,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},mode:"cors"});if(!i.ok)throw new Error(`HTTP ${i.status}`);const o=i.headers.get("content-type");if(!o||!o.includes("application/json"))throw new Error("Response is not JSON format");const c=await i.json();return a||(a=!0,e[s].status="success",l(e),u(c)),{success:!0,apiIndex:s}}catch(t){return e[s].status="error",l(e),{success:!1,apiIndex:s,error:t}}}));Promise.all(o).then((e=>{0!==e.filter((t=>t.success)).length||a||(t.innerHTML='<div class="error">所有API请求失败，请稍后重试</div>')}))}}function u(t){if(!0===t.redirect&&t.target_url)return alert(t.message||"检测到非中文区域，将跳转到 Greasyfork 官方站点"),void(window.location.href=t.target_url);if(!t||0===t.length){const t=document.getElementById("script-results");return t&&(t.innerHTML='<div class="loading">未找到匹配內容</div>'),void h(!0)}const e=document.getElementById("script-results");if(!e)return;const n=t.length;e.innerHTML=c(n),t.forEach(((t,e)=>{!function(t,e){const n=document.getElementById(`skeleton-${t}`);if(!n)return;const s=n.querySelector("article");if(!s)return;const a=e.users?.[0]?.id||"",i=a?`https://gfork.zh-tw.eu.org/zh-hans/users/${a}`:"#",o=e.users?.[0]?.name||"未知作者",r=e.created_at?new Date(e.created_at):null,c=e.code_updated_at?new Date(e.code_updated_at):null,l=t=>t?`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`:"未知",d=`https://gfork.zh-tw.eu.org/zh-hans/scripts/${e.id||""}`;let u=e.code_url||"#";u.includes("update.greasyfork.org/scripts/")&&(u=u.replace("https://update.greasyfork.org/scripts/","/d#/")),s.innerHTML=`\n<h2>\n<a class="script-link" href="${d}" target="_blank">${e.name||"未命名"}</a>\n<span class="badge badge-js" title="用户脚本">JS</span>\n<span class="name-description-separator">-</span>\n<span class="script-description description">${e.description||"暂无描述"}</span>\n</h2>\n<div class="script-meta-block">\n<dl class="inline-script-stats">\n<dt class="script-list-author"><span>作者</span></dt>\n<dd class="script-list-author"><span><a href="${i}">${o}</a></span></dd>\n<dt class="script-list-daily-installs"><span>日安装量</span></dt>\n<dd class="script-list-daily-installs"><span>${e.daily_installs||0}</span></dd>\n<dt class="script-list-total-installs"><span>总安装量</span></dt>\n<dd class="script-list-total-installs"><span>${e.total_installs||0}</span></dd>\n<dt class="script-list-ratings"><span>评分</span></dt>\n<dd class="script-list-ratings" data-rating-score="${e.fan_score||0}">\n<span>\n<span class="good-rating-count" title="评级为好评或已加入到收藏的人数">${e.good_ratings||0}</span>\n<span class="ok-rating-count" title="评级为一般的人数">${e.ok_ratings||0}</span>\n<span class="bad-rating-count" title="评级为差评的人数">${e.bad_ratings||0}</span>\n</span>\n</dd>\n<dt class="script-list-created-date"><span>创建于</span></dt>\n<dd class="script-list-created-date"><span>${l(r)}</span></dd>\n<dt class="script-list-updated-date"><span>更新于</span></dt>\n<dd class="script-list-updated-date"><span>${l(c)}</span></dd>\n<a href="${u}" target="_blank">立即安装此脚本</a>\n</dl>\n</div>\n`;const p=n.querySelector(".loading-overlay");p&&p.remove(),n.classList.remove("skeleton-item"),n.classList.add("fade-in"),n.style.opacity="1",n.style.pointerEvents="auto"}(e,t)})),h(!1)}function p(t){t.preventDefault();const e=document.getElementById("search-submit");if(!e)return void console.error("Search input not found");const n=e.value.trim(),s=new URL(window.location);s.hash=n?`#?q=${encodeURIComponent(n)}`:"#",window.history.pushState({},"",s),d()}function h(t=!1){const e=window.location.hash.substring(2);if(!e)return;const n=new URLSearchParams(e),s=parseInt(n.get("page")||"1"),a=document.getElementById("pagination");if(a){const e=new URLSearchParams(n),i=new URLSearchParams(n),o=new URLSearchParams(n);e.set("page","1");const r=Math.max(s-1,1);i.set("page",r.toString()),o.set("page",(s+1).toString());let c="";c+=`<a href="#?${e.toString()}" ${1===s?'style="visibility:hidden"':""}>回到第一页</a>`,c+=`<a href="#?${i.toString()}" ${1===s?'style="visibility:hidden"':""}>上一页</a>`,c+=`<span class="current">${s}</span>`,c+=t&&s>1?`<a href="#?${o.toString()}" style="visibility:hidden">下一页</a>`:`<a href="#?${o.toString()}">下一页</a>`,a.innerHTML=c}}function g(){const t=i().filter_locale||"0",e=document.getElementById("language-filter");e&&(e.innerHTML=`\n语言筛选：\n<ul>\n<li class="list-option ${"0"===t?"list-current":""}">\n<a href="#" data-filter="0">展示所有语言内容</a>\n</li>\n<li class="list-option ${"1"===t?"list-current":""}">\n<a href="#" data-filter="1">仅展示中文内容</a>\n</li>\n</ul>\n`,e.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault();const n=this.getAttribute("data-filter"),s=i();s.filter_locale=n,Object.keys(s).forEach((t=>{s[t]||delete s[t]}));const a=new URL(window.location.href);a.hash=`#?${new URLSearchParams(s).toString()}`,window.history.pushState({},"",a),e.querySelectorAll(".list-option").forEach((t=>{t.classList.remove("list-current")})),this.parentElement.classList.add("list-current"),d()}))})))}function f(){const t=document.getElementById("search-form");t&&t.addEventListener("submit",p);const e=document.querySelector(".sidebar-search");e&&e.addEventListener("submit",(function(t){t.preventDefault();const n=e.querySelector('input[name="q"]');if(!n)return;const s=i(),a={q:n.value.trim(),sort:s.sort||"",filter_locale:s.filter_locale||"0"};s.site&&(a.site=s.site),Object.keys(a).forEach((t=>{a[t]||delete a[t]}));const o=new URL(window.location.href);o.hash=`#?${new URLSearchParams(a).toString()}`,window.history.pushState({},"",o),m(a.sort||""),d()}))}function m(t){const e=document.getElementById("sort-options-list");if(!e)return;const n=e.querySelectorAll(".list-option");n.forEach((t=>{t.classList.remove("list-current")})),n.forEach((e=>{const n=e.querySelector("a");if(n){const s=new URL(n.href,window.location.origin);(new URLSearchParams(s.hash.substring(2)).get("sort")||"")===t&&e.classList.add("list-current")}}))}function w(){const t=i(),e=t.q||"",n=t.sort||"",s=t.filter_locale||"0",a=t.site||"",o=document.querySelector('.sidebar-search input[name="q"]');o&&(o.value=e);const r=[{value:"",text:"相关程度"},{value:"daily_installs",text:"日安装量"},{value:"total_installs",text:"总安装量"},{value:"ratings",text:"得分"},{value:"created",text:"创建日期"},{value:"updated",text:"更新日期"},{value:"name",text:"名称"}],c=document.getElementById("sort-options-list");c&&(c.innerHTML="",r.forEach((t=>{const i=document.createElement("li");i.className="list-option",t.value===n&&i.classList.add("list-current");const o=document.createElement("a"),r={q:e,sort:t.value,filter_locale:s};a&&(r.site=a),Object.keys(r).forEach((t=>{r[t]||delete r[t]})),o.href=`#?${new URLSearchParams(r).toString()}`,o.textContent=t.text,o.addEventListener("click",(function(e){e.preventDefault(),m(t.value),window.history.pushState({},"",this.href),d()})),i.appendChild(o),c.appendChild(i)})),setTimeout((()=>m(n)),0)),g()}window.addEventListener("popstate",(function(){if("#google_vignette"===window.location.hash)return;m(i().sort||""),g(),d()})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){f(),w(),d()})):(f(),w(),d())}();
