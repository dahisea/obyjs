!function(){const t=!1,e=(...e)=>{t},n=(...e)=>{t};let s="",a=null;const i=[{name:"NODE_M",url:"https://web-static-origin.dahi.edu.cn.dahi.e.yu.ac.cn/gftls",method:"POST"}],o=[{name:"NODE_A",url:"https://api-edge-sakiko-dispatch-network-aws-nf-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",method:"GET"},{name:"NODE_B",url:"https://tencent.api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",method:"GET"},{name:"NODE_C",url:"https://api-edge-sakiko-dispatch-network-aws-cdn.dahi.edu.eu.org/318895e9-64a7-4441-9ee4-625cae200f9b",method:"GET"},{name:"NODE_D",url:"https://dev-volcengine-auth.netlify.app/318895e9-64a7-4441-9ee4-625cae200f9b",method:"GET"}];async function r(){const t=Math.floor(Date.now()/1e3).toString().substring(0,8);return{ss:(await async function(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("")}(t)).substring(0,9)}}function c(t){return!(!t||"#"===t||"#?"===t)&&"#google_vignette"!==t}function l(){const t=window.location.hash;if(!c(t))return s&&c(s)?d(s):{};s=t;const e=d(t);return e.q&&(a=e),e}function d(t){const e=t.startsWith("#?")?t.substring(2):"",n=new URLSearchParams(e),s={};for(const[t,e]of n.entries())s[t]=e;return s}function u(){const t=window.location.hash,e=l(),n=e.q||"",a=e.site||"",i="GFork 檢索",o=!c(t)&&s&&c(s);if(n){let t=a?`${n} - ${i}（${a}）`:`${n} - ${i}`;o&&(t+="：搜索参数已丢失"),document.title=t}else{let t=i;o&&(t+="：搜索参数已丢失"),document.title=t}}async function p(t){const e=l();delete e.locale;const n=await r();if("POST"===t.method){return{url:`${t.url}/${n.ss}`,options:{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},body:Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&"),mode:"cors"}}}{e.ss=n.ss;const s=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&");return{url:s?`${t.url}?${s}`:t.url,options:{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},mode:"cors"}}}}function h(t,e=!1){const n=document.querySelector("footer");if(!n)return;let s=document.getElementById("api-status");if(!e)return void(s&&s.remove());s||(s=document.createElement("div"),s.id="api-status",s.className="api-status",n.appendChild(s));const a=t.map((t=>{const e=t.status||"pending";return`\n<div class="api-item ${e}">\n<span class="material-icons">${{success:"check_circle",pending:"autorenew",error:"error"}[e]||"autorenew"}</span>\n<span>${t.name}</span>\n</div>\n`})).join("");s.innerHTML=`\n<div>备用节点状态：</div>\n<div class="api-list">${a}</div>\n`}async function g(t){if("base64"===t.headers.get("X-Content-Encoding")){const e=function(t){try{const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return new TextDecoder("utf-8").decode(n)}catch(t){throw n(),t}}(await t.text());return JSON.parse(e)}return await t.json()}async function f(){if("#google_vignette"===window.location.hash)return;u();const t=document.getElementById("script-results");if(!t)return void n();const s=l();if(!(s.q||s.site||s.page))return t.innerHTML='<div class="error" style="padding: 20px; text-align: center; color: #ff6b6b;">警告：当前未搜索任何内容</div>',void y(!0);t.innerHTML='\n<div class="loading-container" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; min-height: 400px;">\n<div class="loading-spinner" style="display: flex; flex-direction: column; align-items: center; gap: 20px;">\n<span class="material-icons" style="font-size: 48px; animation: spin 1s linear infinite; color: #4285f4;">autorenew</span>\n<div class="loading-tip" style="text-align: center; color: #666; line-height: 1.6;">\n少女祈祷中…正等待加载脚本。<br>\n注意：所有结果均来源于网络搜索，可靠性未知，请注意甄别代码以及相关内容，谨防欺诈。\n</div>\n</div>\n</div>\n<style>\n@keyframes spin {\nfrom { transform: rotate(0deg); }\nto { transform: rotate(360deg); }\n}\n</style>\n';let a=!1;const r=new AbortController,c=r.signal,d=i.map((async t=>{try{e((t.name,t.method));const n=await p(t);n.options.signal=c;const s=await fetch(n.url,n.options);if(!s.ok)throw new Error(`HTTP ${s.status}`);const a=await g(s);return e(t.name),{success:!0,data:a,node:t}}catch(n){return n.name,e(t.name),{success:!1,error:n,node:t}}}));try{const t=await Promise.race(d.map((async t=>{const e=await t;if(e.success)return e;throw e})));if(t.success&&!a)return a=!0,e(t.node.name),r.abort(),void m(t.data)}catch(t){e()}const f=(await Promise.all(d)).find((t=>t.success));if(f&&!a)return a=!0,e(f.node.name),void m(f.data);e();const w=o.map((t=>({name:t.name,status:"pending"})));h(w,!0);const v=new AbortController,$=v.signal,b=o.map((async(t,n)=>{try{const s=await p(t);s.options.signal=$;const i=await fetch(s.url,s.options);if(!i.ok)throw new Error(`HTTP ${i.status}`);const o=await g(i);return a||(a=!0,w[n].status="success",h(w,!0),v.abort(),e(t.name),m(o)),{success:!0,index:n}}catch(s){return"AbortError"===s.name?e(t.name):(w[n].status="error",h(w,!0)),{success:!1,index:n,error:s}}}));Promise.all(b).then((e=>{0!==e.filter((t=>t.success)).length||a||(t.innerHTML='<div class="error">所有API请求失败，请稍后重试</div>')}))}async function m(t){if(!0===t.redirect&&t.target_url)return alert(t.message||"检测到非中文区域，将跳转到 Greasyfork 官方站点"),void(window.location.href=t.target_url);const e=document.getElementById("script-results");if(!e)return;if(!t||0===t.length)return e.innerHTML='<div class="loading">未找到匹配內容</div>',void y(!0);let n="<ul>";n+='\n<li class="ad-container" style="list-style: none;">\n<ins class="adsbygoogle" \n style="display:block" \n data-ad-client="ca-pub-3758644447684310" \n data-ad-slot="4095096984" \n data-ad-format="auto" \n data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});<\/script>\n</li>\n',t.forEach(((t,e)=>{n+=function(t){const e=t.users?.[0]?.name||"未知作者",n=t.users?.[0]?.id||"",s=n?`https://gfork.zh-tw.eu.org/zh-hans/users/${n}`:"#",a=`https://gfork.zh-tw.eu.org/zh-hans/scripts/${t.id}`;let i=t.code_url||"#";i.includes("update.greasyfork.org/scripts/")&&(i=i.replace("https://update.greasyfork.org/scripts/","/d#/"));const o=t.created_at?new Date(t.created_at):null,r=t.code_updated_at?new Date(t.code_updated_at):null,c=t=>t?`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`:"未知";return`\n<li class="result-item fade-in">\n<article>\n<h2>\n<a class="script-link" href="${a}" target="_blank">${t.name||"未命名"}</a>\n<span class="badge badge-js" title="用户脚本">JS</span>\n<span class="name-description-separator">-</span>\n<span class="script-description description">${t.description||"暂无描述"}</span>\n</h2>\n<div class="script-meta-block">\n<dl class="inline-script-stats">\n<dt class="script-list-author"><span>作者</span></dt>\n<dd class="script-list-author"><a href="${s}">${e}</a></dd>\n<dt class="script-list-daily-installs"><span>日安装量</span></dt>\n<dd class="script-list-daily-installs"><span>${t.daily_installs||0}</span></dd>\n<dt class="script-list-total-installs"><span>总安装量</span></dt>\n<dd class="script-list-total-installs"><span>${t.total_installs||0}</span></dd>\n<dt class="script-list-ratings"><span>评分</span></dt>\n<dd class="script-list-ratings" data-rating-score="${t.fan_score||0}">\n<span>\n<span class="good-rating-count" title="评级为好评或已加入到收藏的人数">${t.good_ratings||0}</span>\n<span class="ok-rating-count" title="评级为一般的人数">${t.ok_ratings||0}</span>\n<span class="bad-rating-count" title="评级为差评的人数">${t.bad_ratings||0}</span>\n</span>\n</dd>\n<dt class="script-list-created-date"><span>创建于</span></dt>\n<dd class="script-list-created-date"><span>${c(o)}</span></dd>\n<dt class="script-list-updated-date"><span>更新于</span></dt>\n<dd class="script-list-updated-date"><span>${c(r)}</span></dd>\n<a href="${i}" target="_blank">立即安装此脚本</a>\n</dl>\n</div>\n</article>\n</li>\n`}(t)})),n+="</ul>",e.innerHTML=n,y(!1)}function w(t){t.preventDefault();const e=document.getElementById("search-submit");if(!e)return void n();const s=e.value.trim(),a=new URL(window.location);a.hash=s?`#?q=${encodeURIComponent(s)}`:"#",window.history.pushState({},"",a),f()}function y(t=!1){const e=window.location.hash.substring(2);if(!e)return;const n=new URLSearchParams(e),s=parseInt(n.get("page")||"1"),a=document.getElementById("pagination");if(a){const e=new URLSearchParams(n),i=new URLSearchParams(n),o=new URLSearchParams(n);e.set("page","1");const r=Math.max(s-1,1);i.set("page",r.toString()),o.set("page",(s+1).toString());let c="";c+=`<a href="#?${e.toString()}" ${1===s?'style="visibility:hidden"':""}>回到第一页</a>`,c+=`<a href="#?${i.toString()}" ${1===s?'style="visibility:hidden"':""}>上一页</a>`,c+=`<span class="current">${s}</span>`,c+=t&&s>1?`<a href="#?${o.toString()}" style="visibility:hidden">下一页</a>`:`<a href="#?${o.toString()}">下一页</a>`,a.innerHTML=c}}function v(){const t=l().filter_locale||"0",e=document.getElementById("language-filter");e&&(e.innerHTML=`\n语言筛选：\n<ul>\n<li class="list-option ${"0"===t?"list-current":""}">\n<a href="#" data-filter="0">展示所有语言内容</a>\n</li>\n<li class="list-option ${"1"===t?"list-current":""}">\n<a href="#" data-filter="1">仅展示中文内容</a>\n</li>\n</ul>\n`,e.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault();const n=this.getAttribute("data-filter"),s=l();s.filter_locale=n,Object.keys(s).forEach((t=>{s[t]||delete s[t]}));const a=new URL(window.location.href);a.hash=`#?${new URLSearchParams(s).toString()}`,window.history.pushState({},"",a),e.querySelectorAll(".list-option").forEach((t=>{t.classList.remove("list-current")})),this.parentElement.classList.add("list-current"),f()}))})))}function $(){const t=document.getElementById("search-form");t&&t.addEventListener("submit",w);const e=document.querySelector(".sidebar-search");e&&e.addEventListener("submit",(function(t){t.preventDefault();const n=e.querySelector('input[name="q"]');if(!n)return;const s=l(),a={q:n.value.trim(),sort:s.sort||"",filter_locale:s.filter_locale||"0"};s.site&&(a.site=s.site),Object.keys(a).forEach((t=>{a[t]||delete a[t]}));const i=new URL(window.location.href),o=new URLSearchParams(a).toString();i.hash=o?`#?${o}`:"#",window.history.pushState({},"",i),b(a.sort||""),f()}))}function b(t){const e=document.getElementById("sort-options-list");if(!e)return;const n=e.querySelectorAll(".list-option");n.forEach((t=>{t.classList.remove("list-current")})),n.forEach((e=>{const n=e.querySelector("a");if(n){const s=new URL(n.href,window.location.origin);(new URLSearchParams(s.hash.substring(2)).get("sort")||"")===t&&e.classList.add("list-current")}}))}function S(){const t=l(),e=t.q||"",n=t.sort||"",s=t.filter_locale||"0",a=t.site||"",i=document.querySelector('.sidebar-search input[name="q"]');i&&(i.value=e);const o=[{value:"",text:"相关程度"},{value:"daily_installs",text:"日安装量"},{value:"total_installs",text:"总安装量"},{value:"ratings",text:"得分"},{value:"created",text:"创建日期"},{value:"updated",text:"更新日期"},{value:"name",text:"名称"}],r=document.getElementById("sort-options-list");r&&(r.innerHTML="",o.forEach((t=>{const i=document.createElement("li");i.className="list-option",t.value===n&&i.classList.add("list-current");const o=document.createElement("a");o.textContent=t.text,o.addEventListener("click",(function(n){n.preventDefault();const i=l(),r={q:i.q||e,sort:t.value,filter_locale:i.filter_locale||s};(i.site||a)&&(r.site=i.site||a),i.page&&(r.page=i.page),Object.keys(r).forEach((t=>{r[t]||delete r[t]}));const c=`#?${new URLSearchParams(r).toString()}`;o.href=c,b(t.value),window.history.pushState({},"",c),f()})),i.appendChild(o),r.appendChild(i)})),setTimeout((()=>b(n)),0)),v()}if(window.addEventListener("popstate",(function(){if("#google_vignette"===window.location.hash)return;b(l().sort||""),v(),u(),f()})),window.addEventListener("hashchange",(function(t){u();const n=window.location.hash;t.oldURL&&new URL(t.oldURL).hash;e(),"#google_vignette"!==n&&c(n)&&(s=n)})),"loading"===document.readyState)document.addEventListener("DOMContentLoaded",(function(){const t=window.location.hash;c(t)&&(s=t),$(),S(),f()}));else{const t=window.location.hash;c(t)&&(s=t),$(),S(),f()}}();